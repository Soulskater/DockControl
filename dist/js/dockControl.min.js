angular.module("DockControl",["Attribute.Directives"]).constant("$alignment",{horizontal:"horizontal",vertical:"vertical",middle:"middle"}).constant("$orientation",{left:"left",right:"right",top:"top",bottom:"bottom",center:"center"}).directive("dock",["pathService",function(t){return{restrict:"AE",replace:!0,transclude:!0,templateUrl:t.templatesBaseUrl+"dock.tmpl.html",controller:"DockCtrl",link:function(t){function e(t){var e=0,n=0;do t.offset()&&(e+=t.offset().top||0,n+=t.offset().left||0),t=t.parent();while(t.length>0);return{top:e,left:n}}t.offset=e($(".panel-container"))}}}]),angular.module("Attribute.Directives",[]).directive("width",[function(){return{restrict:"A",replace:!0,link:function(t,e,n){e.css({width:n.width})}}}]).directive("height",[function(){return{restrict:"A",replace:!0,link:function(t,e,n){e.css({height:n.height})}}}]).directive("minWidth",[function(){return{restrict:"A",replace:!0,link:function(t,e,n){e.css({minWidth:n.minWidth})}}}]).directive("minHeight",[function(){return{restrict:"A",replace:!0,link:function(t,e,n){e.css({minHeight:n.minHeight})}}}]).directive("elementLeave",[function(){return{restrict:"A",replace:!0,link:function(t,e,n){var i=!1,o=function(r){r.target===e[0]||$(r.target).closest(e).length>0||(t.$apply(function(){t.$eval(n.elementLeave,{$event:r})}),i=!1,$(document).unbind("click",o))},r=function(){i=!0,$(document).click(o)};e.click(r),t.$on("$destroy",function(){$(document).unbind("click",o),e.unbind("click",r)})}}}]),angular.module("DockControl").controller("DockCtrl",["$scope","$orientation","$alignment",function(t,e,n){function i(e){linq(t.panels).where(function(t){return t.align!==e.align}).forEach(function(t){(!t.docked||t.docked&&t.index<e.index)&&(t[e.orientation]=e.docked?e.size:0)})}this.addPanel=function(e){t.panels.push(e)},this.panelDockedChanged=function(t){t.docked&&t.setToDefault(),i(t)},this.panelCollapseChanged=function(){},t.$orientation=e,t.panels=[],t.drag=function(o){var r=linq(t.panels).firstOrDefault(function(t){return t.dragging});if(r){switch(r.align){case n.horizontal:r.size=r.orientation===e.left?o.clientX-t.offset.left+5:$(o.currentTarget).width()-o.clientX-t.offset.left+5;break;case n.vertical:r.size=r.orientation===e.top?o.clientY-t.offset.left:$(o.currentTarget).height()-o.clientY-t.offset.left}linq(t.panels).forEach(function(t){i(t)})}},t.endDrag=function(){linq(t.panels).forEach(function(t){t.dragging=!1})}}]),angular.module("DockControl").controller("PanelCtrl",["$scope","$alignment","$orientation",function(t,e,n){function i(){return t.orientation===n.left||t.orientation===n.right?e.horizontal:t.orientation===n.top||t.orientation===n.bottom?e.vertical:e.middle}this.toggleDock=function(){t.toggleDock()},this.toggleCollapse=function(){t.toggleCollapse()},this.setHeader=function(e){t.header=e},this.hasHeader=function(){return""!==t.header},t.toggleDock=function(){t.docked=!t.docked},t.$align=e,t.$orientation=n,t.docked=!1,t.collapsed=!1,t.dragging=!1,t.header="",t.align=i(t.orientation),t.orientation===n.center&&(t.align=e.middle),t.startDrag=function(){t.dragging=!0},t.panelExpand=function(){t.collapsed=!1},t.panelLeave=function(){t.docked||(t.collapsed=!0)},t.setToDefault=function(){t.left="",t.right="",t.top="",t.bottom=""},t.setStyle=function(){return{width:t.align===e.horizontal?t.size:"",height:t.align===e.vertical?t.size:"",left:t.left,right:t.right,top:t.top,bottom:t.bottom}}}]),angular.module("DockControl").directive("panel",["pathService",function(t){return{restrict:"AE",require:"^dock",replace:!0,transclude:!0,scope:{size:"=",minSize:"=",index:"@",orientation:"@"},templateUrl:t.templatesBaseUrl+"panel.tmpl.html",controller:"PanelCtrl",link:function(t,e,n,i){i.addPanel(t),t.$watch("docked",function(e){void 0!==e&&i.panelDockedChanged(t)}),t.docked="true"===n.docked?!0:!1,t.toggleCollapse=function(){t.collapsed=!t.collapsed,i.panelCollapseChanged(t)}}}}]).directive("header",["pathService",function(t){return{restrict:"AE",replace:!0,transclude:!0,require:"^panel",templateUrl:t.templatesBaseUrl+"header.tmpl.html",link:function(t,e,n,i){t.docked=!1,t.toggleDock=function(){i.toggleDock(),t.docked=!t.docked},t.toggleCollapse=function(){i.toggleCollapse()},i.setHeader(e.text())}}}]).directive("content",["pathService",function(t){return{restrict:"AE",replace:!0,transclude:!0,require:"^panel",templateUrl:t.templatesBaseUrl+"content.tmpl.html",link:function(t,e,n,i){$scope.hasHeader=i.hasHeader()}}}]);var scripts=document.getElementsByTagName("script"),currentScriptPath=scripts[scripts.length-1].src,dockControlRootPath=currentScriptPath.split("js/")[0];angular.module("DockControl").service("pathService",[function(){return{templatesBaseUrl:dockControlRootPath+"templates/"}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRvY2tEaXJlY3RpdmUuanMiLCJhdHRyaWJ1dGVEaXJlY3RpdmVzLmpzIiwiZG9ja0N0cmwuanMiLCJwYW5lbEN0cmwuanMiLCJwYW5lbERpcmVjdGl2ZS5qcyIsInJlc291cmNlUGF0aFNlcnZpY2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsUUFBQSxPQUFBLGVBQUEseUJBQ0EsU0FBQSxjQUNBLFdBQUEsYUFDQSxTQUFBLFdBQ0EsT0FBQSxXQUVBLFNBQUEsZ0JBQ0EsS0FBQSxPQUNBLE1BQUEsUUFDQSxJQUFBLE1BQ0EsT0FBQSxTQUNBLE9BQUEsV0FFQSxVQUFBLFFBQUEsY0FBQSxTQUFBLEdBQ0EsT0FDQSxTQUFBLEtBQ0EsU0FBQSxFQUNBLFlBQUEsRUFDQSxZQUFBLEVBQUEsaUJBQUEsaUJBQ0EsV0FBQSxXQUNBLEtBQUEsU0FBQSxHQUdBLFFBQUEsR0FBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLEVBQUEsQ0FDQSxHQUNBLEdBQUEsV0FDQSxHQUFBLEVBQUEsU0FBQSxLQUFBLEVBQ0EsR0FBQSxFQUFBLFNBQUEsTUFBQSxHQUVBLEVBQUEsRUFBQSxlQUNBLEVBQUEsT0FBQSxFQUVBLFFBQ0EsSUFBQSxFQUNBLEtBQUEsR0FkQSxFQUFBLE9BQUEsRUFBQSxFQUFBLDBCQ3JCQSxRQUFBLE9BQUEsMkJBQ0EsVUFBQSxTQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLEtBQUEsTUFBQSxFQUFBLGFBSUEsVUFBQSxVQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLEtBQUEsT0FBQSxFQUFBLGNBSUEsVUFBQSxZQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLEtBQUEsU0FBQSxFQUFBLGdCQUlBLFVBQUEsYUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxLQUFBLFVBQUEsRUFBQSxpQkFJQSxVQUFBLGdCQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxHQUFBLElBQUEsRUFDQSxFQUFBLFNBQUEsR0FDQSxFQUFBLFNBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxRQUFBLFFBQUEsR0FBQSxPQUFBLElBRUEsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsY0FBQSxPQUFBLE1BRUEsR0FBQSxFQUNBLEVBQUEsVUFBQSxPQUFBLFFBQUEsS0FFQSxFQUFBLFdBQ0EsR0FBQSxFQUNBLEVBQUEsVUFBQSxNQUFBLEdBR0EsR0FBQSxNQUFBLEdBSUEsRUFBQSxJQUFBLFdBQUEsV0FDQSxFQUFBLFVBQUEsT0FBQSxRQUFBLEdBQ0EsRUFBQSxPQUFBLFFBQUEsVUMvREEsUUFBQSxPQUFBLGVBQ0EsV0FBQSxZQUFBLFNBQUEsZUFBQSxhQUFBLFNBQUEsRUFBQSxFQUFBLEdBa0JBLFFBQUEsR0FBQSxHQUNBLEtBQUEsRUFBQSxRQUFBLE1BQUEsU0FBQSxHQUNBLE1BQUEsR0FBQSxRQUFBLEVBQUEsUUFDQSxRQUFBLFNBQUEsS0FDQSxFQUFBLFFBQUEsRUFBQSxRQUFBLEVBQUEsTUFBQSxFQUFBLFNBQ0EsRUFBQSxFQUFBLGFBQUEsRUFBQSxPQUFBLEVBQUEsS0FBQSxLQXRCQSxLQUFBLFNBQUEsU0FBQSxHQUNBLEVBQUEsT0FBQSxLQUFBLElBRUEsS0FBQSxtQkFBQSxTQUFBLEdBQ0EsRUFBQSxRQUNBLEVBQUEsZUFFQSxFQUFBLElBRUEsS0FBQSxxQkFBQSxhQWtCQSxFQUFBLGFBQUEsRUFDQSxFQUFBLFVBQ0EsRUFBQSxLQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsS0FBQSxFQUFBLFFBQUEsZUFBQSxTQUFBLEdBQ0EsTUFBQSxHQUFBLFVBRUEsSUFBQSxFQUFBLENBR0EsT0FBQSxFQUFBLE9BQ0EsSUFBQSxHQUFBLFdBQ0EsRUFBQSxLQUFBLEVBQUEsY0FBQSxFQUFBLEtBQUEsRUFBQSxRQUFBLEVBQUEsT0FBQSxLQUFBLEVBQUEsRUFBQSxFQUFBLGVBQUEsUUFBQSxFQUFBLFFBQUEsRUFBQSxPQUFBLEtBQUEsQ0FDQSxNQUNBLEtBQUEsR0FBQSxTQUNBLEVBQUEsS0FBQSxFQUFBLGNBQUEsRUFBQSxJQUFBLEVBQUEsUUFBQSxFQUFBLE9BQUEsS0FBQSxFQUFBLEVBQUEsZUFBQSxTQUFBLEVBQUEsUUFBQSxFQUFBLE9BQUEsS0FHQSxLQUFBLEVBQUEsUUFDQSxRQUFBLFNBQUEsR0FDQSxFQUFBLE9BSUEsRUFBQSxRQUFBLFdBQ0EsS0FBQSxFQUFBLFFBQUEsUUFBQSxTQUFBLEdBQ0EsRUFBQSxVQUFBLFFDdERBLFFBQUEsT0FBQSxlQUNBLFdBQUEsYUFBQSxTQUFBLGFBQUEsZUFBQSxTQUFBLEVBQUEsRUFBQSxHQWtCQSxRQUFBLEtBQ0EsTUFBQSxHQUFBLGNBQUEsRUFBQSxNQUFBLEVBQUEsY0FBQSxFQUFBLE1BQ0EsRUFBQSxXQUVBLEVBQUEsY0FBQSxFQUFBLEtBQUEsRUFBQSxjQUFBLEVBQUEsT0FDQSxFQUFBLFNBRUEsRUFBQSxPQXZCQSxLQUFBLFdBQUEsV0FDQSxFQUFBLGNBR0EsS0FBQSxlQUFBLFdBQ0EsRUFBQSxrQkFHQSxLQUFBLFVBQUEsU0FBQSxHQUNBLEVBQUEsT0FBQSxHQUdBLEtBQUEsVUFBQSxXQUNBLE1BQUEsS0FBQSxFQUFBLFFBYUEsRUFBQSxXQUFBLFdBQ0EsRUFBQSxRQUFBLEVBQUEsUUFHQSxFQUFBLE9BQUEsRUFDQSxFQUFBLGFBQUEsRUFDQSxFQUFBLFFBQUEsRUFDQSxFQUFBLFdBQUEsRUFDQSxFQUFBLFVBQUEsRUFDQSxFQUFBLE9BQUEsR0FDQSxFQUFBLE1BQUEsRUFBQSxFQUFBLGFBQ0EsRUFBQSxjQUFBLEVBQUEsU0FDQSxFQUFBLE1BQUEsRUFBQSxRQUdBLEVBQUEsVUFBQSxXQUNBLEVBQUEsVUFBQSxHQUdBLEVBQUEsWUFBQSxXQUNBLEVBQUEsV0FBQSxHQUdBLEVBQUEsV0FBQSxXQUNBLEVBQUEsU0FDQSxFQUFBLFdBQUEsSUFJQSxFQUFBLGFBQUEsV0FDQSxFQUFBLEtBQUEsR0FDQSxFQUFBLE1BQUEsR0FDQSxFQUFBLElBQUEsR0FDQSxFQUFBLE9BQUEsSUFHQSxFQUFBLFNBQUEsV0FDQSxPQUNBLE1BQUEsRUFBQSxRQUFBLEVBQUEsV0FBQSxFQUFBLEtBQUEsR0FDQSxPQUFBLEVBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxLQUFBLEdBQ0EsS0FBQSxFQUFBLEtBQ0EsTUFBQSxFQUFBLE1BQ0EsSUFBQSxFQUFBLElBQ0EsT0FBQSxFQUFBLFlDeEVBLFFBQUEsT0FBQSxlQUNBLFVBQUEsU0FBQSxjQUFBLFNBQUEsR0FDQSxPQUNBLFNBQUEsS0FDQSxRQUFBLFFBQ0EsU0FBQSxFQUNBLFlBQUEsRUFDQSxPQUNBLEtBQUEsSUFDQSxRQUFBLElBQ0EsTUFBQSxJQUNBLFlBQUEsS0FFQSxZQUFBLEVBQUEsaUJBQUEsa0JBQ0EsV0FBQSxZQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUtBLEVBQUEsU0FBQSxHQUVBLEVBQUEsT0FBQSxTQUFBLFNBQUEsR0FFQSxTQUFBLEdBQ0EsRUFBQSxtQkFBQSxLQUlBLEVBQUEsT0FBQSxTQUFBLEVBQUEsUUFBQSxHQUFBLEVBRUEsRUFBQSxlQUFBLFdBQ0EsRUFBQSxXQUFBLEVBQUEsVUFDQSxFQUFBLHFCQUFBLFNBS0EsVUFBQSxVQUFBLGNBQUEsU0FBQSxHQUNBLE9BQ0EsU0FBQSxLQUNBLFNBQUEsRUFDQSxZQUFBLEVBQ0EsUUFBQSxTQUNBLFlBQUEsRUFBQSxpQkFBQSxtQkFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFFBQUEsRUFDQSxFQUFBLFdBQUEsV0FDQSxFQUFBLGFBQ0EsRUFBQSxRQUFBLEVBQUEsUUFFQSxFQUFBLGVBQUEsV0FDQSxFQUFBLGtCQUVBLEVBQUEsVUFBQSxFQUFBLGFBSUEsVUFBQSxXQUFBLGNBQUEsU0FBQSxHQUNBLE9BQ0EsU0FBQSxLQUNBLFNBQUEsRUFDQSxZQUFBLEVBQ0EsUUFBQSxTQUNBLFlBQUEsRUFBQSxpQkFBQSxvQkFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxPQUFBLFVBQUEsRUFBQSxnQkNsRUEsSUFBQSxTQUFBLFNBQUEscUJBQUEsVUFDQSxrQkFBQSxRQUFBLFFBQUEsT0FBQSxHQUFBLElBQ0Esb0JBQUEsa0JBQUEsTUFBQSxPQUFBLEVBRUEsU0FBQSxPQUFBLGVBQ0EsUUFBQSxlQUFBLFdBQ0EsT0FDQSxpQkFBQSxvQkFBQSIsImZpbGUiOiJkb2NrQ29udHJvbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOC81LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnRG9ja0NvbnRyb2wnLCBbJ0F0dHJpYnV0ZS5EaXJlY3RpdmVzJ10pXHJcbiAgICAuY29uc3RhbnQoJyRhbGlnbm1lbnQnLCB7XHJcbiAgICAgICAgaG9yaXpvbnRhbDogXCJob3Jpem9udGFsXCIsXHJcbiAgICAgICAgdmVydGljYWw6IFwidmVydGljYWxcIixcclxuICAgICAgICBtaWRkbGU6IFwibWlkZGxlXCJcclxuICAgIH0pXHJcbiAgICAuY29uc3RhbnQoJyRvcmllbnRhdGlvbicsIHtcclxuICAgICAgICBsZWZ0OiBcImxlZnRcIixcclxuICAgICAgICByaWdodDogXCJyaWdodFwiLFxyXG4gICAgICAgIHRvcDogXCJ0b3BcIixcclxuICAgICAgICBib3R0b206IFwiYm90dG9tXCIsXHJcbiAgICAgICAgY2VudGVyOiBcImNlbnRlclwiXHJcbiAgICB9KVxyXG4gICAgLmRpcmVjdGl2ZSgnZG9jaycsIFtcInBhdGhTZXJ2aWNlXCIsIGZ1bmN0aW9uICgkcGF0aCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQUUnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJHBhdGgudGVtcGxhdGVzQmFzZVVybCArICdkb2NrLnRtcGwuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEb2NrQ3RybCcsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUub2Zmc2V0ID0gX2Fic29sdXRlT2Zmc2V0KCQoJy5wYW5lbC1jb250YWluZXInKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gX2Fic29sdXRlT2Zmc2V0KGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdG9wID0gMCwgbGVmdCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgZG8ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5vZmZzZXQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wICs9IGVsZW1lbnQub2Zmc2V0KCkudG9wIHx8IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ICs9IGVsZW1lbnQub2Zmc2V0KCkubGVmdCB8fCAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKGVsZW1lbnQubGVuZ3RoID4gMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogdG9wLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBsZWZ0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ21lc3phcm9zIG9uIDkvNS8yMDE0LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ0F0dHJpYnV0ZS5EaXJlY3RpdmVzJywgW10pXHJcbiAgICAuZGlyZWN0aXZlKCd3aWR0aCcsIFtmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jc3Moe3dpZHRoOiBhdHRycy53aWR0aH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnaGVpZ2h0JywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmNzcyh7aGVpZ2h0OiBhdHRycy5oZWlnaHR9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ21pbldpZHRoJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmNzcyh7bWluV2lkdGg6IGF0dHJzLm1pbldpZHRofSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCdtaW5IZWlnaHQnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuY3NzKHttaW5IZWlnaHQ6IGF0dHJzLm1pbkhlaWdodH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnZWxlbWVudExlYXZlJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRvbUNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGV2ZW50LnRhcmdldCA9PT0gZWxlbWVudFswXSB8fCAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdChlbGVtZW50KS5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZXZhbChhdHRycy5lbGVtZW50TGVhdmUsIHsgJGV2ZW50OiBldmVudCB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBhY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS51bmJpbmQoJ2NsaWNrJywgZG9tQ2xpY2tIYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudENsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBhY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLmNsaWNrKGRvbUNsaWNrSGFuZGxlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGljayhlbGVtZW50Q2xpY2tIYW5kbGVyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAgICAgLy9EaXNwb3NpbmdcclxuICAgICAgICAgICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLnVuYmluZCgnY2xpY2snLCBkb21DbGlja0hhbmRsZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudW5iaW5kKCdjbGljaycsIGVsZW1lbnRDbGlja0hhbmRsZXIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdtZXN6YXJvcyBvbiA4LzUvMjAxNC5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdEb2NrQ29udHJvbCcpXHJcbiAgICAuY29udHJvbGxlcignRG9ja0N0cmwnLCBbJyRzY29wZScsICckb3JpZW50YXRpb24nLCAnJGFsaWdubWVudCcsIGZ1bmN0aW9uICgkc2NvcGUsICRvcmllbnRhdGlvbiwgJGFsaWduKSB7XHJcbiAgICAgICAgdGhpcy5hZGRQYW5lbCA9IGZ1bmN0aW9uIChwYW5lbCkge1xyXG4gICAgICAgICAgICAkc2NvcGUucGFuZWxzLnB1c2gocGFuZWwpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5wYW5lbERvY2tlZENoYW5nZWQgPSBmdW5jdGlvbiAocGFuZWwpIHtcclxuICAgICAgICAgICAgaWYgKHBhbmVsLmRvY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgcGFuZWwuc2V0VG9EZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX3NldFNpemUocGFuZWwpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5wYW5lbENvbGxhcHNlQ2hhbmdlZCA9IGZ1bmN0aW9uIChwYW5lbCkge1xyXG4gICAgICAgICAgICAvKmxpbnEoJHNjb3BlLnBhbmVscykuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0gIT09IHBhbmVsICYmIGl0ZW0ub3JpZW50YXRpb24gPT09IHBhbmVsLm9yaWVudGF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5jb2xsYXBzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTsqL1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9zZXRTaXplKHJlZlBhbmVsKSB7XHJcbiAgICAgICAgICAgIGxpbnEoJHNjb3BlLnBhbmVscykud2hlcmUoZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmFsaWduICE9PSByZWZQYW5lbC5hbGlnbjtcclxuICAgICAgICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbiAocGFuZWwpIHtcclxuICAgICAgICAgICAgICAgIGlmICghcGFuZWwuZG9ja2VkIHx8IChwYW5lbC5kb2NrZWQgJiYgcGFuZWwuaW5kZXggPCByZWZQYW5lbC5pbmRleCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYW5lbFtyZWZQYW5lbC5vcmllbnRhdGlvbl0gPSByZWZQYW5lbC5kb2NrZWQgPyByZWZQYW5lbC5zaXplIDogMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUuJG9yaWVudGF0aW9uID0gJG9yaWVudGF0aW9uO1xyXG4gICAgICAgICRzY29wZS5wYW5lbHMgPSBbXTtcclxuICAgICAgICAkc2NvcGUuZHJhZyA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICB2YXIgcGFuZWwgPSBsaW5xKCRzY29wZS5wYW5lbHMpLmZpcnN0T3JEZWZhdWx0KGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5kcmFnZ2luZztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmICghcGFuZWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzd2l0Y2ggKHBhbmVsLmFsaWduKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICRhbGlnbi5ob3Jpem9udGFsOlxyXG4gICAgICAgICAgICAgICAgICAgIHBhbmVsLnNpemUgPSBwYW5lbC5vcmllbnRhdGlvbiA9PT0gJG9yaWVudGF0aW9uLmxlZnQgPyBldmVudC5jbGllbnRYIC0gJHNjb3BlLm9mZnNldC5sZWZ0ICsgNSA6ICQoZXZlbnQuY3VycmVudFRhcmdldCkud2lkdGgoKSAtIGV2ZW50LmNsaWVudFggLSAkc2NvcGUub2Zmc2V0LmxlZnQgKyA1O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAkYWxpZ24udmVydGljYWw6XHJcbiAgICAgICAgICAgICAgICAgICAgcGFuZWwuc2l6ZSA9IHBhbmVsLm9yaWVudGF0aW9uID09PSAkb3JpZW50YXRpb24udG9wID8gZXZlbnQuY2xpZW50WSAtICRzY29wZS5vZmZzZXQubGVmdCA6ICQoZXZlbnQuY3VycmVudFRhcmdldCkuaGVpZ2h0KCkgLSBldmVudC5jbGllbnRZIC0gJHNjb3BlLm9mZnNldC5sZWZ0O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxpbnEoJHNjb3BlLnBhbmVscylcclxuICAgICAgICAgICAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3NldFNpemUoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZW5kRHJhZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbGlucSgkc2NvcGUucGFuZWxzKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmRyYWdnaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9XSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ21lc3phcm9zIG9uIDgvNS8yMDE0LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ0RvY2tDb250cm9sJylcclxuICAgIC5jb250cm9sbGVyKCdQYW5lbEN0cmwnLCBbJyRzY29wZScsICckYWxpZ25tZW50JywgJyRvcmllbnRhdGlvbicsIGZ1bmN0aW9uICgkc2NvcGUsICRhbGlnbiwgJG9yaWVudGF0aW9uKSB7XHJcblxyXG4gICAgICAgIHRoaXMudG9nZ2xlRG9jayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZURvY2soKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLnRvZ2dsZUNvbGxhcHNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlQ29sbGFwc2UoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLnNldEhlYWRlciA9IGZ1bmN0aW9uIChoZWFkZXIpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmhlYWRlciA9IGhlYWRlcjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmhhc0hlYWRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRzY29wZS5oZWFkZXIgIT09IFwiXCI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QWxpZ24ob3JpZW50YXRpb24pIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5vcmllbnRhdGlvbiA9PT0gJG9yaWVudGF0aW9uLmxlZnQgfHwgJHNjb3BlLm9yaWVudGF0aW9uID09PSAkb3JpZW50YXRpb24ucmlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkYWxpZ24uaG9yaXpvbnRhbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLm9yaWVudGF0aW9uID09PSAkb3JpZW50YXRpb24udG9wIHx8ICRzY29wZS5vcmllbnRhdGlvbiA9PT0gJG9yaWVudGF0aW9uLmJvdHRvbSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRhbGlnbi52ZXJ0aWNhbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gJGFsaWduLm1pZGRsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRzY29wZS50b2dnbGVEb2NrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuZG9ja2VkID0gISRzY29wZS5kb2NrZWQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRhbGlnbiA9ICRhbGlnbjtcclxuICAgICAgICAkc2NvcGUuJG9yaWVudGF0aW9uID0gJG9yaWVudGF0aW9uO1xyXG4gICAgICAgICRzY29wZS5kb2NrZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuY29sbGFwc2VkID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmRyYWdnaW5nID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmhlYWRlciA9IFwiXCI7XHJcbiAgICAgICAgJHNjb3BlLmFsaWduID0gZ2V0QWxpZ24oJHNjb3BlLm9yaWVudGF0aW9uKTtcclxuICAgICAgICBpZiAoJHNjb3BlLm9yaWVudGF0aW9uID09PSAkb3JpZW50YXRpb24uY2VudGVyKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5hbGlnbiA9ICRhbGlnbi5taWRkbGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUuc3RhcnREcmFnID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuZHJhZ2dpbmcgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5wYW5lbEV4cGFuZCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmNvbGxhcHNlZCA9IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5wYW5lbExlYXZlID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgICBpZiAoISRzY29wZS5kb2NrZWQpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb2xsYXBzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNldFRvRGVmYXVsdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmxlZnQgPSAnJztcclxuICAgICAgICAgICAgJHNjb3BlLnJpZ2h0ID0gJyc7XHJcbiAgICAgICAgICAgICRzY29wZS50b3AgPSAnJztcclxuICAgICAgICAgICAgJHNjb3BlLmJvdHRvbSA9ICcnO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zZXRTdHlsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiAkc2NvcGUuYWxpZ24gPT09ICRhbGlnbi5ob3Jpem9udGFsID8gJHNjb3BlLnNpemUgOiAnJyxcclxuICAgICAgICAgICAgICAgIGhlaWdodDogJHNjb3BlLmFsaWduID09PSAkYWxpZ24udmVydGljYWwgPyAkc2NvcGUuc2l6ZSA6ICcnLFxyXG4gICAgICAgICAgICAgICAgbGVmdDogJHNjb3BlLmxlZnQsXHJcbiAgICAgICAgICAgICAgICByaWdodDogJHNjb3BlLnJpZ2h0LFxyXG4gICAgICAgICAgICAgICAgdG9wOiAkc2NvcGUudG9wLFxyXG4gICAgICAgICAgICAgICAgYm90dG9tOiAkc2NvcGUuYm90dG9tXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOC81LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnRG9ja0NvbnRyb2wnKVxyXG4gICAgLmRpcmVjdGl2ZSgncGFuZWwnLCBbXCJwYXRoU2VydmljZVwiLCBmdW5jdGlvbiAoJHBhdGgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0FFJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogJ15kb2NrJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIHNpemU6ICc9JyxcclxuICAgICAgICAgICAgICAgIG1pblNpemU6ICc9JyxcclxuICAgICAgICAgICAgICAgIGluZGV4OiAnQCcsXHJcbiAgICAgICAgICAgICAgICBvcmllbnRhdGlvbjogJ0AnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkcGF0aC50ZW1wbGF0ZXNCYXNlVXJsICsgJ3BhbmVsLnRtcGwuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdQYW5lbEN0cmwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycywgZG9ja0N0cmwpIHtcclxuICAgICAgICAgICAgICAgIC8vJHNjb3BlLnNpemUgPSBwYXJzZUZsb2F0KCRzY29wZS5zaXplKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAgICAgLy9BZGQgcGFuZWwgdG8gdGhlIGRvY2tcclxuICAgICAgICAgICAgICAgIGRvY2tDdHJsLmFkZFBhbmVsKCRzY29wZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnZG9ja2VkJywgZnVuY3Rpb24gKHZhbHVlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY2tDdHJsLnBhbmVsRG9ja2VkQ2hhbmdlZCgkc2NvcGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5kb2NrZWQgPSBhdHRycy5kb2NrZWQgPT09IFwidHJ1ZVwiID8gdHJ1ZSA6IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS50b2dnbGVDb2xsYXBzZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY29sbGFwc2VkID0gISRzY29wZS5jb2xsYXBzZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9ja0N0cmwucGFuZWxDb2xsYXBzZUNoYW5nZWQoJHNjb3BlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCdoZWFkZXInLCBbXCJwYXRoU2VydmljZVwiLCBmdW5jdGlvbiAoJHBhdGgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0FFJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgcmVxdWlyZTogJ15wYW5lbCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkcGF0aC50ZW1wbGF0ZXNCYXNlVXJsICsgJ2hlYWRlci50bXBsLmh0bWwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycywgcGFuZWxDdHJsKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZG9ja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudG9nZ2xlRG9jayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYW5lbEN0cmwudG9nZ2xlRG9jaygpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kb2NrZWQgPSAhJHNjb3BlLmRvY2tlZDtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudG9nZ2xlQ29sbGFwc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFuZWxDdHJsLnRvZ2dsZUNvbGxhcHNlKCk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgcGFuZWxDdHJsLnNldEhlYWRlcihlbGVtZW50LnRleHQoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCdjb250ZW50JywgW1wicGF0aFNlcnZpY2VcIiwgZnVuY3Rpb24gKCRwYXRoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBRScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICdecGFuZWwnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJHBhdGgudGVtcGxhdGVzQmFzZVVybCArICdjb250ZW50LnRtcGwuaHRtbCcsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIHBhbmVsQ3RybCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmhhc0hlYWRlciA9IHBhbmVsQ3RybC5oYXNIZWFkZXIoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ21lc3phcm9zIG9uIDEwLzYvMjAxNC5cclxuICovXHJcbnZhciBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XHJcbnZhciBjdXJyZW50U2NyaXB0UGF0aCA9IHNjcmlwdHNbc2NyaXB0cy5sZW5ndGggLSAxXS5zcmM7XHJcbnZhciBkb2NrQ29udHJvbFJvb3RQYXRoID0gY3VycmVudFNjcmlwdFBhdGguc3BsaXQoXCJqcy9cIilbMF07XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnRG9ja0NvbnRyb2wnKVxyXG4gICAgLnNlcnZpY2UoXCJwYXRoU2VydmljZVwiLCBbIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHRlbXBsYXRlc0Jhc2VVcmw6IGRvY2tDb250cm9sUm9vdFBhdGggKyBcInRlbXBsYXRlcy9cIlxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9